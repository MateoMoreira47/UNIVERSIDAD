t-tw":"zh-tw",ko:"ko-kr",ja:"ja-jp",nb:"nb-no"};n.getCurrentLanguage=ut;n.createSuggestion=si;n.createWebSuggestion=hf;n.addSubItemToSuggestion=cf;n.getSyntheticSuggestion=lf;n.getNarratorText=hi;n.isL2=ci;n.iconIsThumbnail=ai;n.displayedInGridLayout=af;n.parseWebSuppressionSignals=vf;let p;n.decodeHtml=yf;let ft;(function(n){n[n.Author=1]="Author";n[n.LastModifiedBy=2]="LastModifiedBy";n[n.Content=3]="Content";n[n.Tags=4]="Tags";n[n.Album=5]="Album";n[n.Artist=6]="Artist";n[n.Genre=7]="Genre";n[n.Location=8]="Location"})(ft=n.MatchType||(n.MatchType={}));n.createMatch=pf;const wf=/[-[\]{}()*+!<=:?.\/\\^$|#,]/g;n.escapeRegex=r;n.tryGetLocationMatch=bf;n.tryGetTextContentMatch=kf;n.matchesOnPropertyHH=df;n.uses3lineTemplate=gf;n.hasReverseHighlighting=ne;n.isEquivalentForPreviewPanePurposes=te;n.isNullOrUndefined=ie;class re{constructor(t,i,r){this.verb=t.verb;this.displayName=t.displayName;this.executeSync=t.executeSync?()=>r(()=>t.executeSync()):()=>r(()=>{n.Async.safeChain("verb.executeAsync",()=>t.executeAsync(),()=>n.Host.manuallyDismissApp(),null,null,null)});this.isDefault=t.isDefault;this.icon=i;this.getIcon=t.getIcon}}n.DeviceItemVerbWrapper=re;n.shouldSetThisPcGroupSource=ue;n.getGroupSourceDisplayName=fe;n.EdgeAppIds=["MSEdge","Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge"];n.AnaheimAppIds=["MSEdge"];n.SpartanAppId="Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge";n.InternetExplorerId="Microsoft.InternetExplorer.Default";n.DMAConsentAppIds=["shell:RecycleBinFolder"];n.getRtlAdjustedKey=ee;n.getSearchSuggestionIcon=oe;n.getWebSuggestionAnnotation=se;n.getSeeWebResultsAnnotationKey=vi;n.msbEnabledForQuery=he;n.isOnlineSuggestionPersonType=yi;n.isOnlineSuggestionMsbFile=pi;n.getMsbTophitSuggestionTypeOrder=ce;n.isMsbOnlineSuggestionType=le;n.isMsbVerticalOnlineSuggestionType=wi;n.isMsbSubverticalOnlineSuggestionType=bi;n.getMsbSuggestionTypeFromSubverticalOnlineSuggestionType=ae;n.isMsbQFSuggestion=o;n.setVisibility=ve;n.setFixHeight=ye;n.setWidth=w;n.setAdaptiveWidth=pe;n.isRtl=ki;n.FOLDERID_Profile="{5E6C858F-0E22-4760-9AFE-EA3317B67173}";n.FOLDERID_SkyDrive="{A52BBA46-E9E1-435f-B3D9-28DAA648C0F6}";n.FOLDERID_System="{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}";n.FOLDERID_SystemX86="{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}";let ot={};n.clearFolderCaches=we;n.getKnownFolderPathLC=b;let st={};n.clearPathExpansionCache=be;let ke=/^\{([a-z0-9-]{36})\}(.*)/i;n.resolveKnownFolderGUIDsInPath=ht;n.indexerFilePathToRegularPath=de;n.enforceOriginalOrder=ge;n.getSubstrateResourceOrScope=no;n.getBingResourceOrScope=to;n.getTweakedSetting=io;n.shouldSkipSelectedScope=ro;n.canShowSearchHomeUpsell=di;n.shouldEnableQuickSearches=gi;n.preconditionForEnableQuickSearches=nr;n.shouldEnableAnaheimResetDefault=uo;n.shouldEnableCodexUpsell=fo;n.shouldEnableBingChatString=tr;n.appendBingChatParams=eo;n.shouldQFSuggToBingChat=oo;n.searchChatIconClassName=ir;n.setSearchSuggestionChatIcon=so;n.shouldSHSuggToBingChat=ho;n.shouldEnableSnipSearch=co;n.canShowQuickSearch=lo;n.canShowQuickSearchWithoutANA=rr;n.shouldUseMsbEnterpriseScopes=ao;n.canShowQuickWorkSearch=vo;n.isAnaheimDataEnabled=u;n.isTSFallbackToANA=!1;n.isTrendingSearchDataEnabled=ur;n.isTSWin11LeftPaneEnabled=!0;n.isTrendingSearchDataInWin11LeftPaneEnabled=yo;n.isASWebEnabledOnSearchHome=po;n.isRecentWorkSearchEnabled=wo;n.canShowAnaheimDataSHListE2E=bo;n.canShowAnaheimDataSHTileE2E=ko;n.canShowAnaheimDataSH=h;n.canShowAnaheimDataQFE2E=go;n.canShowAnaheimDataQF=ct;n.isConsumerWindowsSKU=ns;n.shouldShowTwoColumns=ts;n.currentTabStorageKey="currentTab";n.MeetingDismissedEndDateKey="MeetingDismissedStartDate";n.deepCopy=fr;n.shouldComponentUpdateOverload=is;n.enableMRUSearchHome=rs;n.getFaviconUrlForRawUrl=us;n.getThumbnailServerUrl=er;n.isDynamicSearchContentPossible=k;n.isDynamicSearchContentBaseEnabled=or;n.isDsbEnabledForEnterprise=sr;n.isConsumerDsbEnabledForEnterprise=hr;n.isMsbDsbEnabled=i;n.isWin11GleamEntryPoint=d;n.isDSBAllowedInEntryPoint=lr;n.isZeroInputAllScope=s;n.canShowMsbDsbInWorkScopeZi=at;n.canShowMsbSearchHomeInWorkScopeZi=vt;n.canShowWorkSearchMru=ar;n.canShowMruInWorkScopeZi=vr;n.canShowCuratedSuggestionInEnterpriseScope=os;n.canShowWorkScopeZiPageContent=c;n.canShowWorkFreZiPageContent=ss;n.isWorkScopeDsbGleamRedirect=hs;n.shouldDsbGleamRedirectToAllScope=yr;n.isWorkScopeDsbGleamRedirectOnHoverAllowed=cs;n.isDsbGleamSwitchToScopeEnabled=ls;n.shouldShowDSBLayout=f;n.canShowCuratedSuggestions=pr;n.isCurrentDayMainMomentDismissed=!1;n.shouldShowDSBFullWidth=l;n.isDSBFullWidthFlightEnabled=wr;n.shouldShowTransparentMiniserp=vs;n.shouldShowZIDataSource=g;n.shouldShowStaticSearchHome=a;n.isTwoPanesZIEnabled=yt;n.getMruSuggestionData=pt;n.getMruWebSuggestionData=nt;n.getMruUrlSuggestionData=ys;n.isDocSourceEnabledInQws=ps;n.isMsbQwsDocsCacheEnabled=br;n.isMsbInternalTenant=ws;n.isMsbEnterprise=v;n.isPeopleScopeZI=bs;n.stringifyISearchWebAccount=ks;n.stringifyISearchWebAccounts=ds;n.logToMC=gs;n.isDarkModeEnabled=nh;n.limitWebSuggestions=th;n.isMarketEligible=ih;n.PreviewMetadataContainerId="previewMetadataLocation";n.PreviewMetadataContainer={id:"previewMetadataLocation",selected:!1};n.focusedToolTipHandler=rh;n.isThirdPartySearchAllowed=uh;n.isThirdPartyZeroInputEnabledByRegionalPolicy=fh;n.isThirdPartyMRUEnabledByRegionalPolicy=eh;n.isZeroInputRecentsDisabledByRegionalPolicy=oh;n.isBingGleamDisabledByRegionalPolicy=dr;n.isThirdPartyGleamSupported=sh;n.isSearchDragAndDropEnabled=hh;n.isRemoveIconSelected=ch;n.isChatScopeEnabled=lh;const ah=navigator.userAgent;n.getUserAgent=vh;n.isWin11AlwaysWide=yh;let tt;(function(n){n.RunAsAdmin="RunAs";n.RunAsAdminPreviewPane="pp_RunAs"})(tt||(tt={}));n.dismissAppWhenRunAsAdmin=ph;n.isDMARegion=wh}(WSB||(WSB={})),function(n){let t;(function(n){n.checking="checking";n.downloading="downloading";n.error="error";n.noUpdate="noupdate";n.obsolete="obsolete";n.updateReady="updateready"})(t||(t={}));const i=[t.checking,t.downloading,t.error,t.noUpdate,t.obsolete,t.updateReady];class r{constructor(n=Date.now){this.getNowTimestamp=n;this._appCacheEventIndex=1;this._superFreshEnabled=!1;this._appCache=_w.applicationCache;this.subscribeForEvents()}instrumentSuperFreshUpdate(n){this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.SuperFreshUpdateData.T=this.getNowTimestamp();this._appCacheTimeline.SuperFreshUpdateData.S=n;this.sendAppCacheEvents()}registerSuperFresh(){this._superFreshEnabled=!0}subscribeForEvents(){i.forEach((n,t)=>sj_be(this._appCache,n,()=>this.handleAppCacheEvent(n,t)))}handleAppCacheEvent(n,i){n!=t.checking&&this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.AppCacheEvents[i]=this.getNowTimestamp();switch(n){case t.obsolete:SharedLogHelper.LogWarning("handleAppCacheEvent",null,"AppCache marked as obsolete and will be deleted");this.sendAppCacheEvents();break;case t.error:case t.noUpdate:this.sendAppCacheEvents();break;case t.updateReady:this._superFreshEnabled||this.sendAppCacheEvents()}}sendAppCacheEvents(){let r=_G.ServerIG;if(!r){SharedLogHelper.LogError("sendAppCacheEvents","Could not instrument as server IG not known",new Error("Could not instrument app cache event"));return}let t=this._appCacheTimeline;if(t){let u=t.AppCacheEvents,f=[{I:t.EventIndex,E:u,S:t.SuperFreshUpdateData,ABT:n.InstrumentationHelper.getConversationStartTimestamp()}];u[2]&&(f[0].OL=navigator.onLine);let i=n.InstrumentationCommon.createPerfPingEvent(r,f,"AppCache",n.Host.getConversationId());n.InstrumentationHelper.logEvent(i.EventType,i.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,i.ImpressionGuid,null,null,null);this._appCacheTimeline=this.createAppCacheTimelineObject()}}createAppCacheTimelineObject(){let n={EventIndex:this._appCacheEventIndex,AppCacheEvents:{},SuperFreshUpdateData:{T:undefined,S:undefined}};return this._appCacheEventIndex++,n}}n.AppCacheInstrumentationHelper=r}(WSB||(WSB={})),function(n){const t=["PP","ST","FL","LM"];class i{constructor(){this._isMobile=SearchAppWrapper.CortanaApp.isMobile}logProfilerMarker(t,i,r,u,f){f||(f={});n.safeExecute(()=>{t==1?SearchAppWrapper.CortanaApp.logMeasure("Bing_QF_"+r,i,"QF",JSON.stringify(f),u):SearchAppWrapper.CortanaApp.logVerboseTrace("Bing_QF_"+r,i,"QF",JSON.stringify(f),u)},"logProfilerMarker")}getEnrichedClientInfoForDSB(){var i,r;let t={},u=(i=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())!==null&&i!==void 0?i:0;if(t.windowsAccount=u.toString(),t.snrVersion=n.config.snrVersion,u===1){const i=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.getTenantVariants();i&&(t.msbTenantVariants=i)}if(n.config.wsbWebView2){const n=this.getWebView2Info();t.isWebView2=(n===null||n===void 0?void 0:n.isWebView2)?1:undefined;t.webView2Version=((r=n===null||n===void 0?void 0:n.webView2Version)===null||r===void 0?void 0:r.length)>0?n.webView2Version:undefined}return t}getEnrichedClientInfo(t){var r,u,f,e,o;let p=typeof _G=="object"?_G:{};const h=n.getUserAgent();let i={};if(i.entryPoint=SearchAppWrapper.CortanaApp.entryPoint,i.previousExperience=SearchAppWrapper.CortanaApp.queryFormulationView.previousExperience,i.qfMode=""+n.RuntimeConfig.QfMode,i.isSearchHome=(t===null||t===void 0?void 0:t.isSearchHomeZI)?1:undefined,i.isSVCss=n.config.useCobaltCSS?1:undefined,i.region=n.regionCache||undefined,i.lang=n.uiLanguageCache||undefined,i.DC=p.DA||undefined,i.isMobile=this._isMobile?1:0,i.isXbox=h.toLowerCase().includes("xbox one")?1:0,i.isHololens=h.toLowerCase().includes("hololens")?1:0,i.windowsColor=n.Host.getWindowsTheme(),i.appColor=n.Host.getAppTheme(),n.config.useCobaltCSS)i.WideAtStartupDelta=440;else{let t=n.Host.getFeatureDWORD("WideAtStartupDelta");t.validFeature&&typeof t.featureValue=="number"&&(i.WideAtStartupDelta=t.featureValue)}t&&t.scope!=n.Scope.All&&(i.scope=n.Scope[t.scope]);(t===null||t===void 0?void 0:t.fromSuggestionType)&&(i.fromClick={sType:t.fromSuggestionType,searchHome:t.fromSearchHome?1:undefined});i.deviceHistoryEnabled=n.RuntimeConfiguration.DeviceHistoryEnabled?1:0;let s=(r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())!==null&&r!==void 0?r:0;i.windowsAccount=s.toString();let w=(u=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getMsaAccountsCount())!==null&&u!==void 0?u:0;i.msaAccountsCount=w;let b=(f=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getAadAccountsCount())!==null&&f!==void 0?f:0;i.aadAccountsCount=b;n.isAADVerificationRequired&&(i.aadAccountVerificationRequired=1);n.isMsftAccountConnected&&(i.msftAccountConnected=1);n.isSubstrateO365AccountConnected&&(i.o365Connected=1);n.isSubstrateOutlookAccountConnected&&(i.outlookConnected=1);n.Host.hasFallbackHappened()&&(i.fallback=1);n.Host.isClientLocationAvailable()&&(i.clientLocationAvailable=1);n.Host.isInputPanelVisible()&&(i.isInputPaneVisible=1);n.Host.getWindowsTheme()==2&&(i.darkMode=1);SearchAppWrapper.CortanaApp.colorPrevalenceEnabled&&(i.colorPrevalence=1);SearchAppWrapper.CortanaApp.isSearchBoxInTaskbar&&(i.searchBoxInTaskbar=1);SearchAppWrapper.CortanaApp.taskbarOrientation&&(i.taskbarOrientation=SearchAppWrapper.CortanaApp.taskbarOrientation);n.config.enableEdgeMuidsTelemetry&&SearchAppWrapper.CortanaApp.edgeMuids&&(i.edgeMuidCount=n.Host.getEdgeMuidCount(),i.edgeMuidDefault=n.Host.getEdgeMuidDefault(),i.edgeMuids=n.Host.getEdgeMuidsAdditional(2).join(","));n.config.snrVersion&&(i.snrVersion=n.config.snrVersion);n.osSKUCache&&(i.osSKU=n.osSKUCache.toString());i.ciVersion=n.ConstraintIndex.currentCIVersion;i.defaultBrowser=n.Host.getDefaultBrowser().toString();let c=n.config.enableFuzzyRanking||n.config.enableFuzzyRanking1?n.Host.getFRSuggCount():-1;c>-1&&(i.frSC=c.toString());let l=n.config.enableColdStartRanking||n.config.enableColdStartRanking1?n.Host.getCRCount():-1;l>-1&&(i.crC=l.toString());let a=n.config.enableColdStartRanking||n.config.enableColdStartRanking1?n.Host.getNCRCount():-1;a>-1&&(i.ncrC=a.toString());let v=n.config.enableColdStartRanking||n.config.enableColdStartRanking1?n.Host.getFCRCount():-1;if(v>-1&&(i.fcrC=v.toString()),t===null||t===void 0?void 0:t.isSearchHomeZI){const t=n.dsbManager===null||n.dsbManager===void 0?void 0:n.dsbManager.getDynamicSearchBoxContentKeyAtShown();t&&(i.dsbContentKey=t)}if(n.config.enableDynamicSearchBox&&(i.isDSBEnabledByClient=n.Host.isDSBEnabledByClient(),i.isDSBContentPossible=n.isDynamicSearchContentPossible()),n.msbHost&&(i.tenantMsbStatus=n.msbHost.getTenantMsbStatus(),s===1||s===0)){i.msbSyncdocFired=n.msbHost.qfUtils.getClientQfSyncDocEventFired();i.msbClientQfState=n.msbHost.qfUtils.getMsbClientQfState();const r=n.msbHost.qfUtils.getClientQfStatusMessage();r&&(i.msbClientQfStatusMsg=r);const u=n.msbHost.getTenantVariants();u&&(i.msbTenantVariants=u);i.msbClientQfTrieState=n.safeExecute(()=>n.msbHost.qfUtils.getMsbClientQfTrieState(),"getMsbClientQfTrieState");i.workChatEligibility=n.msbHost.getChatEligibility();n.msbDsbSwitchHost&&n.msbHost.features.isMsbDsbSwitchEnabled()&&(t===null||t===void 0?void 0:t.isSearchHomeZI)&&n.config.enableDynamicSearchBox&&(i.msbDBM=n.msbDsbSwitchHost.getBlendMode())}((e=n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.getFeatures())===null||e===void 0?void 0:e.length)>0&&(i.vks=n.VelocityKeys.getFeatures());i.isSmallIcons=SearchAppWrapper.CortanaApp.isTrayInSmallIconsMode;const y=SearchAppWrapper.CortanaApp.isTraySearchBoxVisibleOnAnyMonitor;if(y!=undefined&&(i.isSearchBoxVisible=y?1:0),n.config.wsbWebView2){const n=this.getWebView2Info();i.isWebView2=(n===null||n===void 0?void 0:n.isWebView2)?1:undefined;i.webView2Version=((o=n===null||n===void 0?void 0:n.webView2Version)===null||o===void 0?void 0:o.length)>0?n.webView2Version:undefined}if(SearchAppWrapper.CortanaApp.systemInfo){const t=n.Host.getSearchAppMemoryCommitMB();i.searchAppMemoryCommitMB=t>0?t:undefined}return i}getSuggestionsPageName(){return"Page.SmartSearch.AS.Suggestions"}getApplicationName(){return"SmartSearch"}getRankerModelId(){return n.Ranking.suggestionFastRankModelIdCurrent}createNonSuggestionDataSourceObject(t,i){return{T:"D.Url",K:i.getKValue(),Val:t,Ho:n.SyntheticQSCodesMaps.HandoffsForNonSuggestions[t],Gr:n.SyntheticQSCodesMaps.GroupsForNonSuggestions[t],NR:1,Properties:i.getProperties()}}createDataSourceObject(t,i){const u=t.mayContainPII&&!n.TestHookUrlParameters,f=(i||t.instItem).getKValue(),e=i&&typeof i.getHandoffType()=="number"?i.getHandoffType():t.handoffType,o=i?i.getQsCode():t.type;let r={T:"D.Url",K:f,Q:u?undefined:t.query,MQ:t.ciMatchedQuery?t.ciMatchedQuery:undefined,Val:o,Ho:e,Ans:t.isAnswer?1:undefined,Gr:n.getGroupType(t),HC:t.hc?1:undefined,RAF:t.useRaf?1:undefined,HS:t.fromHistory?1:undefined,F:t.features.length>0?t.features.join(","):undefined,AC:t.autoCompleteType?t.autoCompleteType:undefined,HCMS:t.highConfidenceMetaSuggestionScore,HCS:t.highConfidenceSuggestionScore,LM:t.suggestionLogMeta,Url:t.url,Uri:t.actionUri,Src:t.source,Sg:t.segments,NR:t.notAResult?1:undefined};if(t.deviceItem?r.DeviceSignals=n.safeExecute(()=>this.buildDeviceItemDataSource(u,t),"buildDeviceItemDataSource"):n.isJumpListSuggestion(t)&&(r.DeviceSignals=n.safeExecute(()=>this.buildJumpListItemDataSource(t),"buildJumpListItemDataSource")),n.TestHookUrlParameters){let n=t;n.path&&(r.path=n.path);n.targetPathLC&&(r.targetPath=n.targetPathLC)}return r.RankerSignals=this.buildRankerOutputDataSource(t),r}buildRankerOutputDataSource(n){if(!n.rankingScore&&!n.featureStore)return undefined;return{rankingScore:n.rankingScore,featureStore:n.featureStore,mruSuppressionScore:n.mruSuppressionScore,fbcScore:n.fbcScore,previewPaneScore:n.previewPaneScore}}buildJumpListItemDataSource(t){let r=t.jumpListItem,i={Rank:r.usagePoints||undefined,LAD:n.isValidDate(r.lastAccessed)?r.lastAccessed.toJSON():undefined};if(n.TestHookUrlParameters)i.path=r.path,i.description=t.tooltip;else if(!i.Rank&&!i.LAD)return undefined;return i}getPathCompletionItem(n){return n.type=="PT"?n.deviceItem:null}buildDeviceItemDataSource(t,i){var e;let f=i.deviceItem,r={Rank:f.rankScore};if(((e=f===null||f===void 0?void 0:f.propertyHitsString)===null||e===void 0?void 0:e.length)>0?r.PHits=f.propertyHitsString:f.propertyHits&&f.propertyHits.length>0&&(r.PHits=f.propertyHits.join(",")),t||(r.Id=f.id,r.DName!=i.query&&(r.DName=f.displayName)),n.TestHookUrlParameters&&(r.kind=f.kind),n.isSetting(i.type))return r.MDN=n.isModernSetting(f)?1:0,r;let u=n.getAppItem(i);if(u)return r.LAD=n.isValidDate(u.lastAccessed)?u.lastAccessed.toJSON():undefined,r.AppLnch=u.totalLaunches,r.Args=u.launchArguments?1:0,r.MDN=u.isImmersive?1:0,r.Ext=u.extension,n.TestHookUrlParameters&&(r.CDT=n.isValidDate(u.createdDate)?u.createdDate.toJSON():undefined,r.LMD=n.isValidDate(u.lastModifiedDate)?u.lastModifiedDate.toJSON():undefined,r.launchArguments=u.launchArguments,r.filePath=u.filePath),r;let o=n.getItemWithFileMetadata(i);if(o){r.Ext=o.extension;n.TestHookUrlParameters&&(r.itemTypeDisplayName=o.itemTypeDisplayName);let t=n.getCommandLineItem(i);if(t)return n.TestHookUrlParameters&&(r.launchArguments=t.launchArguments,r.encodedPath=t.encodedPath),r;if(!this.getPathCompletionItem(i)){let t=i.deviceItem;r.CDT=n.isValidDate(t.createdDate)?t.createdDate.toJSON():undefined;r.LMD=n.isValidDate(t.lastModifiedDate)?t.lastModifiedDate.toJSON():undefined;r.Ext=t.extension?t.extension:""}}return r}logMasterPageImpression(t){n.safeExecute(()=>n.config.enableCETOFlightAssignment?ThresholdInst.LogMasterPageImpressions(t,null,t.enrichedClientInfo):ThresholdInst.LogPageImpression(t,null,t.enrichedClientInfo),"logMasterImpressionForClient")}logDataSourceTimeout(i,r){if(SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure)for(let u of t)n.isDataSourceEnabled(u,r)&&!n.contains(i,u)&&n.safeExecute(()=>SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure(n.providerFailureLogName(u),"NoReturnForTopHit"),"logProviderFailure")}onItemClick(){SearchAppWrapper.CortanaApp.queryFormulationView.resetConversationIdNextTimeQFIsShown&&SearchAppWrapper.CortanaApp.queryFormulationView.resetConversationIdNextTimeQFIsShown()}getWebView2Info(){var t;if(!this._cachedWV2Info){const i=n.getUserAgent(),r=i.includes("IsWebView2/True"),u=r?(t=i.match(/\(WebView2Version (.*)\)/))===null||t===void 0?void 0:t[1]:"";this._cachedWV2Info={isWebView2:r,webView2Version:u}}return this._cachedWV2Info}}n.WSBInstrumentationProvider=i}(WSB||(WSB={})),function(n){const r="/QF_KEYSTROKE_VIRTUAL_URL?",i="autosuggest";class t{static init(i,r){t._keystrokesInstrumentationData={};t._instrumentationProvider=i;t._clientTelemetry=r;ClientInstConfig.queueDumpInterval=n.config.logQueueDumpInterval;_w.ClTrCo.SharedClickSuppressed=!0;n.Host.bindShown(n=>t._clientShownTimestamp=n);n.Host.bindConversationStart(()=>t.onConversationStart());t._conversationTimeline={RawImpressionGuid:"",ImpressionGuid:"",ConversationId:"",AppVisibleStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AppVisibleFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AppShownStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AppShownFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE}}static bindFinalizeKeystroke(n){t._finalizeKeystrokeHandlers.push(n)}static bindKeystrokeTimelineUpdated(n){t._keystrokeTimelineUpdatedHandlers.push(n)}static fireKeystrokeTimelineUpdatedHandlers(n){t._keystrokeTimelineUpdatedHandlers.forEach(t=>t(n))}static getRawImpressionGuid(i){let r=t._keystrokesInstrumentationData[i];return r&&r.RawImpressionGuid?r.RawImpressionGuid:(SharedLogHelper.LogError("getRawImpressionGuid","sequenceNumber: "+i+" ConversationID: "+n.Host.getConversationId(),new Error("No instrumentation data/no IG found for sequenceNumber")),"")}static getImpressionGuid(n){let i=t._keystrokesInstrumentationData[n];if(i&&i.ImpressionGuid)return i.ImpressionGuid;throw"getImpressionGuid(): No IG for sequence "+n;}static updateSuggestionsList(n,i){t._clientTelemetry&&t._clientTelemetry.updateSuggestionsList(n,i)}static instrumentKeyDown(n){t._keyDownTimeStamp=n}static instrumentFetchProviderBegin(i,r){i>0&&t.safeInstrumentPerf(i,i=>{n.config.perfInstV2&&(i.DataProvidersStarted[r]=t.getOffsettedNow())},"instrumentFetchProviderBegin",null)}static instrumentFetchesBegin(i){t.safeInstrumentPerf(i,i=>{i.DataSourcesFetchBegin=t.getOffsettedNow(),n.config.perfInstV2&&(i.DataProviderFetchStart=t.getOffsettedNow())},"instrumentFetchesBegin",null)}static instrumentFetchesEnd(n){t.safeInstrumentPerf(n,n=>{n.DataSourcesFetchEnd=t.getOffsettedNow()},"instrumentFetchesEnd",null)}static instrumentDataSourceParsed(n,i){t.safeInstrumentPerf(n,n=>{let r=t.getOffsettedNow();typeof n.ResponseParsed[i]!="number"?n.ResponseParsed[i]=r:(n.MultipleResponsesParsed[i]||(n.MultipleResponsesParsed[i]=[n.ResponseParsed[i]]),n.MultipleResponsesParsed[i].push(r))},"instrumentDataSourceParsed",i)}static instrumentItemClickForPreviewPane(n,i,r,u,f,e,o,s,h){if(i.getHandoffType()!=999){let c=t.createBaseCustomGPingPayload(f,e);t.addPreviewPaneDataToGPingPayload(c,o,s,h);t.instrumentItemClickAndGPing(c,n,i,r,u,f)}}static isContextMenuVerbClickEvent(t){switch(t){case"RemoveFromDeviceHistory":case"RemoveFromDeviceHistoryAll":case n.JumplistActionItemType[n.JumplistActionItemType.StartPin]:case n.JumplistActionItemType[n.JumplistActionItemType.StartUnpin]:case n.JumplistActionItemType[n.JumplistActionItemType.TaskbarPin]:case n.JumplistActionItemType[n.JumplistActionItemType.TaskbarUnpin]:case n.JumplistActionItemType[n.JumplistActionItemType.PinToStartScreen]:case n.JumplistActionItemType[n.JumplistActionItemType.S_CopyFullPath]:case n.JumplistActionItemType[n.JumplistActionItemType.S_CopyPersonDetails]:return!1;default:return!0}}static instrumentItemClickForContextMenu(n,i,r,u,f,e,o){if(i.getHandoffType()!=999)if(this.isContextMenuVerbClickEvent(o)){let s=t.createBaseCustomGPingPayload(f,e);t.addContextMenuDataToGPingPayload(s,o);t.instrumentItemClickAndGPing(s,n,i,r,u,f)}else t.instrumentLayoutItemSelect(i,r)}static instrumentItemClick(n,i,r,u,f,e){let o=i.getHandoffType();if(o!=999)if(o==998||o==997)t.instrumentLayoutItemSelect(i,r);else{let o=t.createBaseCustomGPingPayload(f,e);if(i.getProperties()){let n=i.getProperties();t.addExtraPropsToGPingPayload(o,n)}t.instrumentItemClickAndGPing(o,n,i,r,u,f)}}static instrumentItemClickAndGPing(i,r,u,f,e,o){if(!n.config.disableWSBServerTelemetry||!n.isDMARegion()){t.sendCustomGPing(i,u.getHValue(),r);let h=t._keystrokesInstrumentationData[f],s=t._keystrokesInstrumentationData[f];s?(h.RenderingStarted||t.updatePageIG(f),_G.IG!=s.ImpressionGuid&&SharedLogHelper.LogError("instrumentItemClick","IG ("+s.ImpressionGuid+") for sequenceNumber "+f+" does not match the page IG ("+_G.IG+")",new Error("IG for sequence number does not match the currently rendered page's IG (_G.IG)")),t._clientTelemetry&&t._clientTelemetry.logItemClickedMeasure(s.ConversationId,s.RawImpressionGuid,u,o)):SharedLogHelper.LogError("instrumentItemClick","sequenceNumber: "+f+" ConversationID: "+n.Host.getConversationId(),new Error("No instrumentation data found for sequenceNumber"));t.finalizeKeystrokeLog(f,1);e&&e();t._instrumentationProvider.onItemClick();n.config.forceLogFlush?Log2.ForceFlush():Log2.FlushMainQueueDontForce();_w.clickFlushedTime=sb_gt()}}static instrumentLayoutItemSelect(n,i){let r={AppNS:n.getAppNS(),K:n.getLayoutKValue()};t.logClientInstEvent("Select","ItemClicked",i,r)}static instrumentDSBChevronSelect(i){let r={scenario:i};t.logClientInstEvent("Select","DSBMegaChevronClicked",n.SequenceNumberManager.getSequenceNumber(),r)}static instrumentDSBChevronDirection(i,r){let u={scenario:i,direction:r};t.logClientInstEvent("Select","DSBMegaChevronDirectionClicked",n.SequenceNumberManager.getSequenceNumber(),u)}static instrumentPerfEvent(i,r,u){n.config.logClientPerf&&t.safeInstrumentPerf(i,n=>{t._instrumentationProvider.logProfilerMarker(1,0,r,n.RawImpressionGuid,{d:u})},"instrumentPerfEvent")}static instrumentAggregateFunctionPerf(i,r){n.config.logClientPerf&&t._clientTelemetry.logAggregateFunctionPerf(i,r)}static instrumentDeviceQueryBegin(n){t._instrumentationProvider.logProfilerMarker(1,0,"StartDeviceQuery",n,{})}static createBaseCustomGPingPayload(n,i){let r={};switch(n){case 1:r.i="k";r.mk=t.getModifierKeyCodes(i);break;case 3:r.i="t";break;case 4:r.i="p";break;case 5:r.i="n";break;case 6:r.i="b";break;case 0:r.i="x";r.mk=t.getModifierKeyCodes(i);break;default:r.mk=t.getModifierKeyCodes(i)}return r}static addContextMenuDataToGPingPayload(n,t){n.cm=t}static addExtraPropsToGPingPayload(n,t){Object.keys(t).forEach(i=>{n[i]=t[i]})}static addPreviewPaneDataToGPingPayload(n,t,i,r){t&&(n.pp=t,i&&(n.ppit=i),typeof r=="number"&&(n.rho=r))}static sendCustomGPing(t,i,r){let u=i;n.isEmpty(t)||(u+="&PR="+JSON.stringify(t));n.safeExecute(()=>_w.si_T(u,null,null,0,r),"logCustomGPing")}static getModifierKeyCodes(n){if(n){let t=n.altKey?"A":"";if(t+=n.ctrlKey?"C":"",t+=n.shiftKey?"S":"",t)return t}return undefined}static notifyTopHitPreviewPaneOpenedOrInterrupted(i,r){let u=t._keystrokesPerfPingData[i];u&&u.PreviewPanePendingInfo!=null&&(u.PreviewPanePendingInfo.latency=t.getOffsettedNow(),r?u.PreviewPaneOpened=u.PreviewPanePendingInfo:u.PreviewPaneCanceled=u.PreviewPanePendingInfo,u.PreviewPanePendingInfo=null,t.tryInstrumentRenderStopped(i,u));n.config.perfInstV2&&r&&t.safeInstrumentPerf(i,n=>{n.PreviewPaneFinish=t.getOffsettedNow()},"instrumentFetchesEnd",null)}static previewPaneOpenedOrClosed(n,i,r,u,f,e){let o=n?"Select":"Unselect",s=n?"PreviewPaneOpened":"PreviewPaneClosed";if(t.logClientInstEvent(o,s,i,e),n&&t._keystrokesPerfPingData[i]&&t.notifyTopHitPreviewPaneOpenedOrInterrupted(i,!0),n&&t._clientTelemetry){let n=t._keystrokesInstrumentationData[i];n&&t._clientTelemetry.logPreviewPaneOpenedMeasure(r,u,f)}}static logClientInstEvent(n,i,r,u){let f=null;if(r){let n=t._keystrokesInstrumentationData[r];n&&(f=n.ImpressionGuid)}t.logEvent(n,u,i,null,null,f,null,null,null)}static safeInstrument(n,i,r,u){let f=t._keystrokesInstrumentationData[n];if(f)i(f);else{var e=u?" DS: "+u:"";SharedLogHelper.LogError(r,(u?u+" ":"")+" sequenceNumber: "+n,new Error("No instrumentation data found for sequenceNumber"+e))}}static safeInstrumentPerf(i,r,u,f){let e=t._keystrokesPerfPingData[i];if(e)n.safeExecute(()=>r(e),u);else{var o=f?" DS: "+f:"";SharedLogHelper.LogError(u,(f?f+" ":"")+" sequenceNumber: "+i+" Current sequenceNumber: "+n.SequenceNumberManager.getSequenceNumber(),new Error("No instrumentation data found for sequenceNumber"+o))}}static instrumentRenderingStarted(n){t.safeInstrument(n,i=>{i.RenderingStarted=!0,t.updatePageIG(n)},"instrumentRenderingStarted")}static instrumentQueryChangedRequest(i,r){delete t._keystrokesInstrumentationData[i-1];n.InstrumentedItem.resetKValues(i);let h=t._keystrokesPerfPingData[i];h&&SharedLogHelper.LogError("instrumentQueryChangedRequest","sequenceNumber: "+i,new Error("Duplicate BeginRequest for sequenceNumber"));let f=n.Host.getConversationId(),u=n.Host.getRawImpressionGuid(),e=n.cleanGuid(u),o=n.getCurrentTime(),c={RawImpressionGuid:u,ImpressionGuid:e,ConversationId:f,Query:r,PendingDataSources:{},DataSources:{},RankerExtraInfo:{},DuplicateDS:{},Layout:[],MasterPageImpressionCreated:!1,RenderingStarted:!1,PendingInstrumentedItems:{},PendingSyntheticSuggestions:{},OriginalTimestamp:o},s={RawImpressionGuid:u,ImpressionGuid:e,ConversationId:f,PrefixLength:r.queryToFetch?r.queryToFetch.length:0,SearchHomeRenderEvent:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,ClientShownEvent:t.getOffsettedNow(t._clientShownTimestamp),RequestBegin:t.getOffsettedNow(o),ResponseReceived:{},MultipleResponsesReceived:{},DataSourcesState:t._searchServiceStatus?{Indexer:t._searchServiceStatus}:undefined,RenderFinished:{},renderGroupFinished:{},AllRenderFinished:0,AllDataSourcesProcessed:!1,PendingIcons:0,PreviewPanePendingInfo:undefined,TopResultRendered:[],ResponseFromCache:{},DataSourcesFetchBegin:0,DataSourcesFetchEnd:0,ResponseParsed:{},PreviewPaneOpened:{},PreviewPaneCanceled:{},PageLoadTime:0,SearchHomeLoadTime:0,FirstRenderTime:0,MultipleResponsesParsed:{},ConversationStart:n.config.perfInstV2?t._conversationStartTimestamp:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,SequenceStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,DataProviderFetchStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,DataProviderFetchFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,DataProvidersStarted:{},DataProvidersFinished:{},RendersCompleted:{},RendersColdRank:{},PreviewPaneStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,PreviewPaneFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AnaheimDataIndexCount:{},MRUDataTelemetry:{},MRUFilesAndFoldersDefinedCount:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,MRUFilesAndFoldersUndefinedCount:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE};t._keystrokesInstrumentationData[i]=c;t._keystrokesPerfPingData[i]=s;t._currentRender=0;n.config.perfInstV2&&t._keyDownTimeStamp!=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE&&(t.safeInstrumentPerf(i,n=>{n.SequenceStart=t._keyDownTimeStamp-t._conversationStartTimestamp},"instrumentKeyDown",null),t._keyDownTimeStamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE);t._clientTelemetry&&t._clientTelemetry.logNewKeystrokeMeasure(f,u,r);t.updatePageIG(i);t.fireKeystrokeTimelineUpdatedHandlers(s);(n.config.enableFuzzyRanking||n.config.enableFuzzyRanking1)&&n.Host.setFRSuggCount(-1);(n.config.enableColdStartRanking||n.config.enableColdStartRanking1)&&(n.Host.setCRCount(-1),n.Host.setNCRCount(-1),n.Host.setFCRCount(-1));(n.config.enableMRUFilesAndFoldersTelemetry||n.config.disableMRUFilesAndFoldersWildCards)&&(n.Host.setMRUFilesAndFoldersDefinedCount(0),n.Host.setMRUFilesAndFoldersUndefinedCount(0))}static setSearchServiceStatus(n){t._searchServiceStatus=n}static instrumentResponseReceived(i,r,u,f,e,o){t.safeInstrumentPerf(i,i=>{if(!e){let u=t.getOffsettedNow();typeof i.ResponseReceived[r]!="number"?(i.ResponseReceived[r]=u,n.config.useWhereId&&r=="IFF"):(i.MultipleResponsesReceived[r]||(i.MultipleResponsesReceived[r]=[i.ResponseReceived[r]]),i.MultipleResponsesReceived[r].push(u))}u&&(i.DataSourcesState=i.DataSourcesState||{},i.DataSourcesState[r]=u);f&&(i.ResponseFromCache[r]=f)},"instrumentResponseReceived",r);n.config.perfInstV2&&t.safeInstrumentPerf(i,n=>{o||(n.DataProvidersFinished[r]=t.getOffsettedNow(),n.DataProviderFetchFinish<n.DataProvidersFinished[r]&&(n.DataProviderFetchFinish=n.DataProvidersFinished[r])),u&&(n.DataSourcesState=n.DataSourcesState||{},n.DataSourcesState[r]=u),f&&(n.ResponseFromCache[r]=f)},"instrumentResponseReceived",r)}static instrumentTopResultRendered(i,r,u){t.safeInstrumentPerf(i,f=>{let e=t.getOffsettedNow(),o="T"+r.join(",");if(f.renderGroupFinished[o])u||(f.renderGroupFinished[o].iconsFinished=e);else{if(f.TopResultRendered.push({V:e,T:r.join(",")}),t._clientTelemetry){let n=e-f.RequestBegin;t._clientTelemetry.logTopResultsRenderedMeasure(f.RawImpressionGuid,r,n)}f.renderGroupFinished[o]={iconsFinished:e,suggestionsFinished:e}}t.tryInstrumentRenderStopped(i,f);n.MockUrlParameters&&n.safeFireEvent("TopResultRendered")},"instrumentTopResultRendered")}static instrumentRenderedLocalSuggestion(n,i){let u=t._keystrokesInstrumentationData[n];if(u){let n={},t={};for(var r=0;r<i.length;r++)i[r].type=="FV"?n[r]="TBD":i[r].type=="HU"&&(t[r]="TBD");u.FvSug=n;u.HuSug=t}}static instrumentAggregatorCall(i){t.safeInstrument(i,i=>{let r={fastRankModelId:t._instrumentationProvider.getRankerModelId()};for(let n in i.RankerExtraInfo)r[n]=i.RankerExtraInfo[n];i.RankerExtraInfo={};let u={T:"D.Aggregator",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Aggregator",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:[],rankerModelIds:r};i.DataSources.aggregator=u},"instrumentAggregatorCall")}static instrumentDSB(){t.safeInstrument(n.SequenceNumberManager.getSequenceNumber(),t=>{let r=n.dsbManager.getInstrumentedProps(),u=[],i=null;if(r){for(let t=0;t<r.length;t++){let e=r[t],f=e===null||e===void 0?void 0:e.instrumentedItem,o=e===null||e===void 0?void 0:e.subItemInstrumentedItems;if(o&&o.length>0)for(let t=0;t<o.length;t++){let i=o[t],r={T:"D.url",Val:i===null||i===void 0?void 0:i.getQsCode(),Ho:i===null||i===void 0?void 0:i.getHandoffType(),Gr:n.GroupType.DSBGroup,K:i===null||i===void 0?void 0:i.getKValue()};(i===null||i===void 0?void 0:i.getProperties())&&(r.Properties=i.getProperties());u.push(r)}i===null&&(i=f===null||f===void 0?void 0:f.getWorkflow());let s=f===null||f===void 0?void 0:f.getProperties(),h={T:"D.url",Val:f===null||f===void 0?void 0:f.getQsCode(),Ho:f===null||f===void 0?void 0:f.getHandoffType(),Gr:n.GroupType.DSBGroup,K:f===null||f===void 0?void 0:f.getKValue()};s&&(h.Properties=s);u.push(h)}let f=Object.assign(Object.assign({T:"D.DSB",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"DSB",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE},i?{Workflow:i}:undefined),{DS:u});t.DataSources.dsb=f}},"instrumentDSB")}static addDuplicatesDataSource(t){let i=Object.keys(t.DuplicateDS).map(n=>t.DuplicateDS[n]);i.length>0&&(t.DataSources.duplicates={T:"D.Duplicates",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Duplicates",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:i})}static instrumentDuplicate(i,r,u){t.safeInstrument(i,t=>{let i=t.DuplicateDS[r.instItem.getHValue()];i||(i={T:"D.Duplicate",DS:[{T:"D.DSRef",KRef:r.instItem.getKValue()}]},r.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(i.DS[0].AppNS=r.instItem.getAppNS()),t.DuplicateDS[r.instItem.getHValue()]=i);let f={T:"D.DSRef",KRef:u.instItem.getKValue()};u.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(f.AppNS=u.instItem.getAppNS());i.DS.push(f)},"instrumentDuplicate")}static renderingStopped(n){return n.PendingIcons==0&&n.AllDataSourcesProcessed&&n.PreviewPanePendingInfo==null}static notifyAllDataSourcesProcessed(n){t.safeInstrumentPerf(n,i=>{i.AllDataSourcesProcessed=!0,t.tryInstrumentRenderStopped(n,i)},"notifyAllDataSourcesProcessed")}static notifyIconPending(n,i,r){t.safeInstrumentPerf(n,n=>{n.PendingIcons++},"notifyIconPending",(i?"TR":"SUG")+" From "+(r?r:"unknown"))}static notifyIconReadyOrFailed(n,i){t.safeInstrumentPerf(n,n=>{n.PendingIcons--},"notifyIconReadyOrFailed",i?"TR":"SUG")}static notifyPreviewPaneStartRender(i){n.config.perfInstV2&&t.safeInstrumentPerf(i,n=>{n.PreviewPaneStart=t.getOffsettedNow()},"previewPaneStart")}static notifyPreviewPanePending(n,i,r){let u=t._keystrokesPerfPingData[n];u&&(u.PreviewPanePendingInfo={previewPaneType:i,suggestionType:r})}static tryInstrumentRenderStopped(i,r){t.renderingStopped(r)&&(t.finalizeKeystrokeLog(i,2),t.logMemoryUsageInWSBClient(i,"RenderStopped"),n.TestHookUrlParameters&&n.safeFireEvent("RenderStopped"))}static logMemoryUsageInWSBClient(i,r){var u;if(SearchAppWrapper.CortanaApp.systemInfo){let f=SearchAppWrapper.CortanaApp.systemInfo;const s=typeof BingAtWork=="undefined"?"":(u=BingAtWork.context)===null||u===void 0?void 0:u.midgardVersion,e=t._instrumentationProvider.getWebView2Info(),o=f.totalCommitMB;let h="TotalCommitMB:"+o+",TotalWorkingSetMB:"+f.totalWorkingSetMB+",SnrVersion:"+n.config.snrVersion+",MsbVersion:"+s+",IsWebView2:"+(e.isWebView2?1:0)+",WebView2Version:"+e.webView2Version;n.Host.setSearchAppMemoryCommitMB(o);t._instrumentationProvider.logProfilerMarker(1,0,r,t.getRawImpressionGuid(i),h)}}static isLayoutLogged(n){return t._keystrokesInstrumentationData[n].MasterPageImpressionCreated}static finalizeKeystrokeLog(n,i=0){t._finalizeKeystrokeHandlers.forEach(n=>n(i==0));let r=t._keystrokesInstrumentationData[n];if(r&&t.logKeystrokeData(r,n),i!=1){let i=t._keystrokesPerfPingData[n];i&&(t.logPerfPingEvent(t.createKeystrokePerfPingEvent(n,i)),t._clientTelemetry&&t._clientTelemetry.logDataSourcePerformancesMeasure(i),t.fireKeystrokeTimelineUpdatedHandlers(i))}}static instrumentZiRendered(i,r,u){r&&t.logMemoryUsageInWSBClient(i,"ZiRendered");n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("RenderZeroInput");let f=u?u:null;t.safeInstrumentPerf(i,n=>{n.SearchHomeRenderEvent=t.getOffsettedNow()},"instrumentSearchHomeRender",f)}static instrumentRenderFinished(i,r,u,f,e){if(n.config.perfInstV2&&(t===null||t===void 0?void 0:t._currentRender)<0)SharedLogHelper.LogError("instrumentRenderFinished","sequenceNumber: "+i,new Error("Invalid current render for sequence number"));else if(n.config.perfInstV2&&t._keystrokesPerfPingData[i]==undefined)SharedLogHelper.LogError("instrumentRenderFinished","sequenceNumber: "+i+" currentRender: "+t._currentRender,new Error("No keystrokesPerfPingData for sequence number"));else if(e||t._keystrokesPerfPingData[i].FirstRenderTime||(t._keystrokesPerfPingData[i].FirstRenderTime=t.getOffsettedNow()),n.config.perfInstV2){if(t._keystrokesPerfPingData[i].RendersCompleted[t._currentRender]=t.getOffsettedNow(),n.Host.getFCRCount()>-1&&(n.config.enableColdStartRanking||n.config.enableColdStartRanking1)&&(t._keystrokesPerfPingData[i].RendersColdRank[t._currentRender]=n.Host.getFCRCount()),(n.config.disableMRUFilesAndFoldersWildCards||n.config.enableMRUFilesAndFoldersTelemetry)&&(n.Host.getMRUFilesAndFoldersDefinedCount()>-1&&(t._keystrokesPerfPingData[i].MRUFilesAndFoldersDefinedCount=n.Host.getMRUFilesAndFoldersDefinedCount()),n.Host.getMRUFilesAndFoldersUndefinedCount()>-1&&(t._keystrokesPerfPingData[i].MRUFilesAndFoldersUndefinedCount=n.Host.getMRUFilesAndFoldersUndefinedCount())),n.isAnaheimDataEnabled(!0)||n.isAnaheimDataEnabled(!1)){if(n.AnaheimDataProvider&&n.AnaheimDataProvider.InstrumentStringNumber){let r=n.AnaheimDataProvider.InstrumentStringNumber;for(let n in r)t._keystrokesPerfPingData[i].AnaheimDataIndexCount[n]=r[n]}if(n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.InstrumentStringNumber){let r=n.AnaheimDataProviderV2.InstrumentStringNumber;for(let n in r)t._keystrokesPerfPingData[i].AnaheimDataIndexCount[n]=r[n]}if(n.AnaheimDataParser===null||n.AnaheimDataParser===void 0?void 0:n.AnaheimDataParser.getANANumberMap){let r=n.AnaheimDataParser.getANANumberMap();for(let n in r)t._keystrokesPerfPingData[i].AnaheimDataIndexCount[n]=r[n]}}t._currentRender++}t.safeInstrumentPerf(i,n=>{let e=t.getOffsettedNow(),o="S"+r.join(",");n.renderGroupFinished[o]?f||(n.renderGroupFinished[o].iconsFinished=e):(r.forEach(t=>n.RenderFinished[t]=e),n.renderGroupFinished[o]={iconsFinished:e,suggestionsFinished:e});t.tryInstrumentRenderStopped(i,n);t._clientTelemetry&&t._clientTelemetry.logGroupsRenderedMeasure(u)},"instrumentRenderFinished",r.join(","));let o=t._keystrokesPerfPingData[i];o&&t.fireKeystrokeTimelineUpdatedHandlers(o)}static instrumentSyntheticInstrumentedItem(n,i,r){let u=t._keystrokesInstrumentationData[n];u?u.PendingInstrumentedItems[i]=r:SharedLogHelper.LogError("instrumentSyntheticInstrumentedItem",i,new Error("keystrokesInstrumentationData not found"))}static instrumentSyntheticSuggestion(n,i){let r=t._keystrokesInstrumentationData[n];r?r.PendingSyntheticSuggestions[i.type]=i:SharedLogHelper.LogError("instrumentSyntheticSuggestion",i.type,new Error("Instrumentation synthetic suggestion after flush"))}static getInstrumentedSyntheticSuggestion(n,i){return t._keystrokesInstrumentationData[n].PendingSyntheticSuggestions[i]}static instrumentDataSource(n,i,r,u){t.safeInstrument(n,n=>{if(u&&u.rankerExtraInfo)for(let t in u.rankerExtraInfo)n.RankerExtraInfo[t]=u.rankerExtraInfo[t];let t=r||[],f=n.PendingDataSources[i];n.PendingDataSources[i]=f?f.concat(t):t},"instrumentDataSource",i)}static processPendingDataSources(i){for(let r in i.PendingDataSources){let u=i.PendingDataSources[r];if(u.length>0){let f=[];for(let n of u){f.push(t._instrumentationProvider.createDataSourceObject(n));for(let i of n.subInstItems||[])f.push(t._instrumentationProvider.createDataSourceObject(n,i))}r=="Web"&&(r="WebAS");f.length>0&&(i.DataSources[r]={T:"D."+r,AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:r,SC:f.length,DS:f})}}i.PendingDataSources={}}static instrumentSnRProviderFetchUrl(n,i){t.safeInstrument(n,n=>{n.SnRProviderFetchUrl=i},"instrumentSnRProviderFetchUrl")}static onConversationStart(){if(t._conversationStartTimestamp=n.getCurrentTime(),t._searchServiceStatus=null,t._clientTelemetry){let i=n.Host.getConversationId();t._clientTelemetry.logConversationStartMeasure(i)}t._keystrokesPerfPingData=[];t._currentRender=0}static getConversationStartTimestamp(){return t._conversationStartTimestamp}static logDataSourceTimeout(n,i){t._instrumentationProvider.logDataSourceTimeout(n,i)}static getPpoFromPpi(n){return typeof n.latency=="number"?{L:n.latency,T:n.previewPaneType}:{}}static createKeystrokePerfPingEvent(i,r){let u={I:i,PL:r.PrefixLength,K:r.RequestBegin,F:r.DataSourcesFetchEnd,PPO:t.getPpoFromPpi(r.PreviewPaneOpened),PPC:t.getPpoFromPpi(r.PreviewPaneCanceled),RRT:r.ResponseReceived,RPT:r.ResponseParsed,MRT:r.MultipleResponsesReceived,RFT:r.RenderFinished,TRR:r.TopResultRendered,RS:undefined,PLT:undefined,HLT:undefined,FRT:undefined,IRFT:{},TRIR:[],MPT:r.MultipleResponsesParsed,CS:n.config.perfInstV2?r.ConversationStart:undefined,KS:n.config.perfInstV2?r.SequenceStart:undefined,RB:n.config.perfInstV2?r.RequestBegin:undefined,FS:n.config.perfInstV2?r.DataProviderFetchStart:undefined,FF:n.config.perfInstV2?r.DataProviderFetchFinish:undefined,PST:n.config.perfInstV2?r.DataProvidersStarted:undefined,PFT:n.config.perfInstV2?r.DataProvidersFinished:undefined,RC:n.config.perfInstV2?r.RendersCompleted:undefined,RCR:n.config.perfInstV2&&(n.config.enableColdStartRanking||n.config.enableColdStartRanking1)?r.RendersColdRank:undefined,PS:n.config.perfInstV2?r.PreviewPaneStart:undefined,PF:n.config.perfInstV2?r.PreviewPaneFinish:undefined,ANA:n.config.perfInstV2&&(n.config.enableAnaheimDataSH||n.config.enableAnaheimDataQF)?r.AnaheimDataIndexCount:undefined,MRUFAF:n.config.perfInstV2&&(n.config.enableMRUFilesAndFoldersTelemetry||n.config.disableMRUFilesAndFoldersWildCards)?r.MRUFilesAndFoldersDefinedCount:undefined,MRUFAFU:n.config.perfInstV2&&(n.config.enableMRUFilesAndFoldersTelemetry||n.config.disableMRUFilesAndFoldersWildCards)?r.MRUFilesAndFoldersUndefinedCount:undefined};for(let n in r.renderGroupFinished){let t=r.renderGroupFinished[n];if(t.iconsFinished!=t.suggestionsFinished){let i=n.substr(1);if(n.startsWith("T"))u.TRIR.push({T:i,V:t.iconsFinished});else{let n=i.split(",");for(let i of n)u.IRFT[i]=Math.max(t.iconsFinished,u.IRFT[i]||0)}}}if(t.renderingStopped(r)){let t=0;for(let n in r.renderGroupFinished)t=Math.max(t,r.renderGroupFinished[n].iconsFinished);r.FirstRenderTime&&(u.FRT=r.FirstRenderTime);t&&(r.AllRenderFinished=t,u.RS=t,t=Math.max(t,r.PreviewPaneOpened.latency||r.PreviewPaneCanceled.latency||0),r.PageLoadTime=t,u.PLT=t);r.SearchHomeRenderEvent!=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE&&(u.HLT=Math.max(u.PLT-u.K,r.SearchHomeRenderEvent))}else{let n=t.getOffsettedNow();u.RS=n;u.PLT=n}return n.InstrumentationCommon.createPerfPingEvent(r.ImpressionGuid,[u],"Keystroke",r.ConversationId,r.DataSourcesState,r.ResponseFromCache)}static updatePageIG(n){_G.IG=t.getImpressionGuid(n)}static createMasterPageImpression(r,u,f,e,o){let s={dataSources:o||[],layoutNodes:[],pageName:r,rawQuery:e?e.queryToFetch:"",isQuery:!1,impressionUrl:t.createVirtualImpressionURL(u,f),appName:t._instrumentationProvider.getApplicationName(),enrichedClientInfo:{FDPartnerEntry:i,nclid:_G.nclid,isOffline:n.isBrowserOnline()?0:1,webRequested:f?1:0}},h=n.safeExecute(()=>t._instrumentationProvider.getEnrichedClientInfo(e),"getEnrichedClientInfo");if(h)for(let n in h)s.enrichedClientInfo[n]=h[n];if(n.config.addExtraInstLoad){if(n.config.extraInstLoadSize&&!t.extraInstPayload){let i="";while(i.length<n.config.extraInstLoadSize)i+="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";t.extraInstPayload=i}n.config.addExtraInstLoadPercentage&&Date.now()%100<=n.config.addExtraInstLoadPercentage&&(s.enrichedClientInfo.exInst=t.extraInstPayload)}return s}static logKeystrokeData(i){t.processPendingDataSources(i);n.TestHookUrlParameters&&t.addDuplicatesDataSource(i);let f=Object.keys(i.DataSources).map(n=>i.DataSources[n]).concat(t.createNonSuggestionsDataSource(i.PendingInstrumentedItems,i.PendingSyntheticSuggestions));if(i.DataSources={},i.PendingSyntheticSuggestions={},i.PendingInstrumentedItems={},f.length!=0||!i.MasterPageImpressionCreated){let u;if(i.RenderingStarted&&(u=DsLManager.CreateLayoutNode(_d.body,n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,!1,!0,i.MasterPageImpressionCreated,!0)),i.MasterPageImpressionCreated)t.logEvent("ClientInst",null,null,f,u,i.ImpressionGuid,null,null,null);else{let n=t.createMasterPageImpression(t._instrumentationProvider.getSuggestionsPageName(),r,i.SnRProviderFetchUrl?i.SnRProviderFetchUrl.substring(i.SnRProviderFetchUrl.indexOf("?")+1):"",i.Query,f);u&&(n.layoutNodes=u);i.FvSug&&Object.keys(i.FvSug).length>0&&(n.enrichedClientInfo.FvSug=i.FvSug);i.HuSug&&Object.keys(i.HuSug).length>0&&(n.enrichedClientInfo.HuSug=i.HuSug);n.clientTimestamp=i.OriginalTimestamp;t.logMasterPageImpression(i.ImpressionGuid,n);i.MasterPageImpressionCreated=!0}}}static logPerfPingEvent(i){t.logEvent(i.EventType,i.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,i.ImpressionGuid,null,null,null);n.ClientTestHooks&&n.ClientTestHooks.DebugLogNoConsole("perfPingEvent",[i])}static logMasterPageImpression(i,r){if(r){if(!i){SharedLogHelper.LogError("logMasterPageImpression",null,new Error("Missing impressionGuid"));return}if(n.config.disableWSBServerTelemetry&&n.isDMARegion())return;r.impressionGuid=i;t._instrumentationProvider.logMasterPageImpression(r,n.Host.getConversationId());n.ClientTestHooks&&n.ClientTestHooks.DebugLogNoConsole("masterPageImpression",r,i)}}static instrumentAppVisibleFinish(i){let r=n.getCurrentTime();t._conversationTimeline.AppVisibleStart=i;t._conversationTimeline.AppVisibleFinish=r}static instrumentAppShownFinish(i){let r=n.getCurrentTime();t._conversationTimeline.AppShownStart=i;t._conversationTimeline.AppShownFinish=r}static instrumentConversationTimelineFinish(){let i=_G.ServerIG;if(!i){SharedLogHelper.LogError("instrumentConversationTimelineFinish","Could not instrument as server IG not known",new Error("Could not instrument initilization finish"));return}t._conversationTimeline.RawImpressionGuid=n.Host.getRawImpressionGuid();t._conversationTimeline.ImpressionGuid=n.cleanGuid(t._conversationTimeline.RawImpressionGuid);t._conversationTimeline.ConversationId=n.Host.getConversationId();let r={CID:t._conversationTimeline.ConversationId,ASB:t._conversationTimeline.AppShownStart,ASF:t._conversationTimeline.AppShownFinish,AVB:t._conversationTimeline.AppVisibleStart,AVF:t._conversationTimeline.AppVisibleFinish},u=n.InstrumentationCommon.createPerfPingEvent(i,[r],"ConversationTimeline",t._conversationTimeline.ConversationId);t.logPerfPingEvent(u)}static instrumentPerformance(i,r){try{let e=_G.ServerIG;if(!e){SharedLogHelper.LogError("instrumentPerformance "+i,"Could not instrument as server IG not known",new Error("Could not instrument performance "+i));return}let u=_w.performance,f=new window.Map;if(r){let t=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;if(u&&u.timing&&(t=u.timing.navigationStart),t<=0)return;let i=r.getTime()-t,e=n.getCurrentTime()-t;f.BLT=i;f.ILT=e}this.addNavigationPerformanceInfo(u,f);"LoadError"!==i&&r||this.addResourcePerformanceInfo(u,f);let o=[f],s=n.InstrumentationCommon.createPerfPingEvent(e,o,i);t.logPerfPingEvent(s)}catch(u){typeof SharedLogHelper!="undefined"&&SharedLogHelper.LogError("instrumentPerformanceException",i,u)}}static addNavigationPerformanceInfo(n,t){if(n&&t){let i=n.getEntriesByType("navigation");if(i&&i.length>0){let n=i[0];n&&(t.WST=Math.round(n.workerStart),t.FST=Math.round(n.fetchStart),t.RQST=Math.round(n.requestStart),t.RPST=Math.round(n.responseStart),t.RPET=Math.round(n.responseEnd),t.DCLST=Math.round(n.domContentLoadedEventStart),t.DCLET=Math.round(n.domContentLoadedEventEnd),t.DCT=Math.round(n.domComplete),t.LEST=Math.round(n.loadEventStart),t.LEET=Math.round(n.loadEventEnd),t.ECBS=n.encodedBodySize?Math.round(n.encodedBodySize):"",t.DCBS=n.decodedBodySize?Math.round(n.decodedBodySize):"")}}}static addResourcePerformanceInfo(n,t){if(n&&t){let r=n.getEntriesByType("resource"),i=[];r.forEach(n=>{if(n.duration>0&&n.duration>2e3){let t=n,r=new window.Map;r.NAME=t.name;r.ENTYPE=t.entryType;r.INITYPE=t.initiatorType;r.NHPL=t.nextHopProtocol;r.ST=Math.round(t.startTime);r.RDET=Math.round(t.redirectEnd);r.FST=Math.round(t.fetchStart);r.DLST=Math.round(t.domainLookupStart);r.DLET=Math.round(t.domainLookupEnd);r.CST=Math.round(t.connectStart);r.SCST=Math.round(t.secureConnectionStart);r.CET=Math.round(t.connectEnd);r.RQST=Math.round(t.requestStart);r.RPST=Math.round(t.responseStart);r.RPET=Math.round(t.responseEnd);r.DURN=Math.round(t.duration);r.ECBS=t.encodedBodySize?Math.round(t.encodedBodySize):"";r.DCBS=t.decodedBodySize?Math.round(t.decodedBodySize):"";r.TFS=t.transferSize?Math.round(t.transferSize):"";i.push(r)}});i.length>0&&(t.RS=i)}}static instrumentDSBEvent(r){let f={dataSources:[],layoutNodes:[],pageName:"Page.SmartSearch.AS.DSB",rawQuery:"",isQuery:!1,impressionUrl:"",appName:t._instrumentationProvider.getApplicationName(),enrichedClientInfo:{FDPartnerEntry:i,nclid:_G.nclid,isOffline:n.isBrowserOnline()?0:1},impressionGuid:t.createCleanGuid()},u={};if(u=n.safeExecute(()=>t._instrumentationProvider.getEnrichedClientInfoForDSB(),".instrumentDSBEvent.getEnrichedClientInfoForDSB"),u)for(let n in u)f.enrichedClientInfo[n]=u[n];for(const n in r)f.enrichedClientInfo[n]=r[n];n.config.disableWSBServerTelemetry&&n.isDMARegion()||t._instrumentationProvider.logMasterPageImpression(f,null)}static getOffsettedNow(i=n.getCurrentTime()){return i-t._conversationStartTimestamp}static createNonSuggestionsDataSource(i,r){let u=[];for(let n in i)u.push(t._instrumentationProvider.createNonSuggestionDataSourceObject(n,i[n]));for(let i in r)(r[i].staticGroupType!=n.GroupType.MsbOnRampButton||r[i].suppressed!=!0)&&u.push(t._instrumentationProvider.createDataSourceObject(r[i]));if(u.length){let t={T:"D.ContentGroup",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"NonSuggestions",SC:u.length,DS:u};return[t]}return[]}static createVirtualImpressionURL(t,i){let r=n.getWindowProtocol()+"//"+n.getWindowHost()+t;return r+=i?i:n.Service.QueryParams.ConversationId+"="+n.encodeQueryParameter(n.Host.getConversationId()),_G.ServerIG&&(r+="&ASInitIG="+n.encodeQueryParameter(_G.ServerIG)),r}static createCleanGuid(n){return n?(n^Math.random()*16>>n/4).toString(16):"10000000100040008000100000000000".replace(/[018]/g,t.createCleanGuid)}static createCodexClickItemProps(n,t){return n.setProperty("FID","Codex"),n.setProperty("Namespace","WindowsSearchBox"),n.setProperty("EventType","ConversationViewEnter"),n.setProperty("source",t),n}static updateMessageBannerClickItemProps(n,t){return n.setProperty("FID","ReclaimSearchbox"),n.setProperty("Namespace","WindowsSearchBox"),n.setProperty("EventType","RecleamSearchBoxEventEnter"),n.setProperty("source",t),n}static logFlightState(n,i){t._clientTelemetry.logFlightState(n,i)}static logEvent(t,i,r,u,f,e,o,s,h){n.config.disableWSBServerTelemetry&&n.isDMARegion()||Log2.LogEvent(t,i,r,u,f,e,o,s,h)}}t._clientShownTimestamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;t._conversationStartTimestamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;t._currentRender=0;t._keyDownTimeStamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;t._keystrokesPerfPingData={};t._keystrokesInstrumentationData={};t._keystrokeTimelineUpdatedHandlers=[];t._finalizeKeystrokeHandlers=[];n.InstrumentationHelper=t}(WSB||(WSB={})),function(n){const t="&nclid=",i="&ts=",r="&nclidts=",u="&tsms=",f="&elv=",e="&cc=",o="&setlang=",s="&cvid=",h="&qs=",c="&ao=",l="&wsso=";class a{constructor(t=Date.now,i=n.getWindowProtocol()+"//"+n.getWindowHost()){if(this.getNowTimestamp=t,this._baseUrl=i,n.config.enableOfflineWithWeb&&n.config.webHost&&n.isBrowserOnline()&&(this._baseUrl=n.config.webHost),n.config.overrideHost){let t=n.getWindowHost();t.startsWith("www.")&&(this._baseUrl=n.getWindowProtocol()+"//"+n.config.overrideHost+t.substring(3))}}getSearchUrl(t,i,r,u,e,o,s,h,a,v){if(!u)if(e===21)u=(n.msbHost.features.isEduScopeApplicable()?"/school":"/work")+"/search?q="+n.encodeQueryParameter(i),v&&(u+="&inithash="+v),o=n.mapOSFormCode((v===null||v===void 0?void 0:v.includes("Connectors"))?"WSBWSC":"WSBWS0");else{let t=this.getVerticalFromHandoffType(e);u=(t?"/"+t:"")+"/search?q="+n.encodeQueryParameter(i)}let y=this._baseUrl+u;y+=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isWindowsTest)?"&form=MONITR&traffictype=wintest":"&form="+n.encodeQueryParameter(o!==null&&o!==void 0?o:n.Host.getFormCode());a&&(y+=c+"1");y=this.enrichUrlWithSuggestionType(y,h?"P":r);y=this.enrichUrlWithCvid(y);n.config.suppressPqParameter||(y+="&pq="+n.encodeQueryParameter(t));let p=n.Host.getMSNRefIg();if(p&&(y+="&refig="+p),y=this.enrichUrlWithMarketInfo(y),y=this.enrichUrlWithDeviceInfo(y),!s){y=this.enrichUrlWithMuidInfo(y);let t=n.Host.getElToken();t&&this._baseUrl.startsWith("https:")&&(y+=f+n.encodeQueryParameter(t));y=this.enrichUrlWithSafeSearchInfo(y)}let w=n.Host.getSafeSearchSetting();return w&&(y+=l+w),y}getImageSearchUrl(){let t=this._baseUrl+"/images/detail/upload?FORM="+n.mapOSFormCode("SBIWSB");return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isWindowsTest)&&(t+="&isWindowsTest=1&traffictype=Test"),t}getVerticalFromHandoffType(n){return n===13?"images":n===14?"videos":n===15?"shop":""}enrichUrlWithDeviceInfo(t){n.Host.isEducationEnvironment()&&(t+="&DAF0=1");n.Host.isWindowsS()&&(t+="&DAF1=1");let i=n.Host.getPartnerSearchCode();return i&&(t+="&PC="+i),t}enrichUrlWithMarketInfo(t){let i=n.Host.getRegion(),r=n.Host.getLanguage();return i&&(t+=e+i),r&&(t+=o+r),t}enrichUrlWithSafeSearchInfo(t){return n.Host.getSafeSearchSetting()=="Strict"?t+"&adlt=strict":t}enrichUrlWithMuidInfo(f){if(_G.nclid){f+=t+n.encodeQueryParameter(_G.nclid);let e=this.getNowTimestamp().toString();f+=i+n.encodeQueryParameter(e);let o=e.substring(0,e.length-3);f+=r+n.encodeQueryParameter(o);let s=e.substring(e.length-3);f+=u+n.encodeQueryParameter(s)}return f}enrichUrlWithCvid(t){return t+(s+n.encodeQueryParameter(n.Host.getConversationId()))}enrichUrlWithSuggestionType(t,i){return t+(h+n.encodeQueryParameter(i))}getChatUrl(t){return"https://www.bing.com/search?q="+n.encodeQueryParameter(t)+"&showconv=1&sendquery=1&form=WSBMSC"}enrichUrlWithWorkScopeHash(n,t){return n===21&&t?"#"+t:""}}n.NavigationHelper=a}(WSB||(WSB={})),function(n){class t{constructor(t){this._selectableItemsContainer=t;n.Host.bindKeyDown((i,r,u)=>{this.selectedItem=this.getSelectedItem();let f=!1;if(i==9)f=this.selectFirstItemInNextGroup(r&&r.shiftKey);else if((n.isUpOrDownKey(i)||n.isLeftOrRightKey(i))&&this.isMsbDsbSelected(this.selectedItem)){const t=n.isUpKey(i)||n.isLeftKey(i);f=this.selectNextItemInGroup(t)}else n.isUpOrDownKey(i)&&(f=this.selectNextItem(n.isUpKey(i)));t.onAfterKeyDown(i,r,u,f)})}selectFirstItemInNextGroup(t){var s,e,o;const r=this._selectableItemsContainer.getSelectableItemsByGroup();if(r.length==0)return!1;const i=r.findIndex(n=>!!n.find(n=>{var t,i;return n.reactKey?n.reactKey===((t=this.selectedItem)===null||t===void 0?void 0:t.reactKey):n.id===((i=this.selectedItem)===null||i===void 0?void 0:i.id)}));let f;f=i<0?-1:this.isMsbDsbSelected(this.selectedItem)?r[i].findIndex(n=>{var t;return n.id===((t=this.selectedItem)===null||t===void 0?void 0:t.id)}):r[i].findIndex(n=>n==this.selectedItem);this.selectedItem&&(this.selectedItem.selected=!1,(e=(s=this.selectedItem).onUnselected)===null||e===void 0?void 0:e.call(s));let u;return(i<0?u=r[0][0]:t?!this.isMsbDsbSelected(this.selectedItem)&&f>0?u=r[i][0]:i>0&&(u=r[i-1][0],u.hiddenAfterFocus&&i>=2&&(u=r[i-2][0])):i+1<r.length?u=r[i+1][0]:f+1<r[i].length&&((o=this.selectedItem)===null||o===void 0?void 0:o.scope)==n.Scope.Work&&(u=r[i][f+1]),u)?(this._selectableItemsContainer.select(u,!0),u.onSelected&&u.onSelected(),!0):!1}selectNextItem(t){var o,f,s,e;const i=this._selectableItemsContainer.getSelectableItems();if(i.length==0)return!1;const r=this.selectedItem?i.findIndex(n=>{var t,i;return n.reactKey?n.reactKey===((t=this.selectedItem)===null||t===void 0?void 0:t.reactKey):n.id===((i=this.selectedItem)===null||i===void 0?void 0:i.id)}):-1;this.selectedItem&&(this.selectedItem.selected=!1,(f=(o=this.selectedItem).onUnselected)===null||f===void 0?void 0:f.call(o));const h=t?r==0:r==i.length-1;if(h&&n.RuntimeConfig.AllowKeyboardNavOffCanvas)return this._selectableItemsContainer.select(null,!0),!0;if(h&&!n.RuntimeConfig.AllowKeyboardNavCycling)return!1;const u=t?r<=0?i.length-1:r-1:(r+1)%i.length;return this._selectableItemsContainer.select(i[u],!0),i[u]&&i[u].onSelected&&((e=(s=i[u]).onSelected)===null||e===void 0?void 0:e.call(s)),!0}selectNextItemInGroup(t){var h,e,f,o;const i=this._selectableItemsContainer.getSelectableItemsByGroup();if((i===null||i===void 0?void 0:i.length)==0)return!1;const s=i.findIndex(n=>!!n.find(n=>{var t;return n.id===((t=this.selectedItem)===null||t===void 0?void 0:t.id)}));if(s<0)return!1;const r=i[s],u=r.findIndex(n=>n==this.selectedItem);this.selectedItem&&(this.selectedItem.selected=!1,(e=(h=this.selectedItem).onUnselected)===null||e===void 0?void 0:e.call(h));const l=t?u==0:u==r.length-1;if(l&&!n.RuntimeConfig.AllowKeyboardNavCycling)return!1;const c=t?u<=0?r.length-1:u-1:(u+1)%r.length;return this._selectableItemsContainer.select(i[s][c],!0),(o=(f=r[c])===null||f===void 0?void 0:f.onSelected)===null||o===void 0?void 0:o.call(f),!0}getSelectedItem(){let t;return this.selectedItem||!(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.keyNavSetFocus)?(t=this._selectableItemsContainer.getSelectedItem(),this.isMsbDsbSelected(this.selectedItem)&&(t=this._selectableItemsContainer.getSelectableItems().find(n=>n.selected)||t)):(t=this._selectableItemsContainer.getSelectableItems().find(t=>t.id===(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.keyNavSetFocus)),this._selectableItemsContainer.select(t,!0)),t}isMsbDsbSelected(t){return!!n.isMsbEnterprise()&&!!(t===null||t===void 0?void 0:t.dsb)}}n.KeyboardEvtHandler=t}(WSB||(WSB={})),function(n){n.LatencyTimeout=500;n.MsbPeopleLatencyTimeout=1e3;class t{constructor(n,t){this._aggregator=n;this._rootViewModel=t;this._sequenceNumber=-1;this._suggestionsQueue={};this._dataSourcesCompleted={}}initiateSequenceNumber(t,i,r){if(!(n.isThirdPartySearchAllowed===null||n.isThirdPartySearchAllowed===void 0?void 0:n.isThirdPartySearchAllowed())||i.scope!=n.Scope.ThirdPartyWeb){if(this._sequenceNumber>=t){SharedLogHelper.LogError("initiateSequenceNumber",null,new Error("Unexpected sequence number"));return}this.resetStateForNewQuery(t,i);this._highPriorityDataSources=[];this._normalPriorityDataSources=[];this._lowPriorityDataSources=[];for(let t of n.config.enabledDataSources){let r=i.enabledDataSources[t];r&&(n.config.lowPriorityDataSources[t]?this._lowPriorityDataSources.push(t):n.config.highPriorityDataSources[t]?t==="MSBC"&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.isWaitForBackfillEnabled(i.scope))?this._lowPriorityDataSources.push(t):this._highPriorityDataSources.push(t):this._normalPriorityDataSources.push(t))}if(this._HighPriDoneProcessing=this._highPriorityDataSources.length==0,this._highPriorityDataSources.length==0&&this._normalPriorityDataSources.length==0&&this._lowPriorityDataSources.length==0)this.processSuggestions(!1);else{let t=this.getLatencyTimeout();t>0&&(this._bufferingTimer=n.safeSetTimeout(()=>{this._bufferingTimer=null,this.processSuggestions(!0)},t,"processSuggestionsBuffering"),n.config.dataSourceTimeLimit&&(this._processingTimeoutTimer=n.safeSetTimeout(()=>{this._processingTimeoutTimer=null;let t=[...this._highPriorityDataSources.filter(t=>!n.contains(this._arrivedDataSources,t)),...this._normalPriorityDataSources.filter(t=>!n.contains(this._arrivedDataSources,t)),...this._lowPriorityDataSources.filter(t=>!n.contains(this._arrivedDataSources,t)),];SharedLogHelper.LogError("SuggestionsRenderingManager",t.join(","),new Error("Data provider did not complete before the time limit"));this._processingStopped=!0;this._allDataSourcesArrived=!0;this.processSuggestions(!1);r&&r()},n.config.dataSourceTimeLimit,"processSuggestionsTimeout")))}}}getLatencyTimeout(){var t,i;return this._partialQuery.queryToFetch?this._partialQuery.scope===n.Scope.People&&n.isMsftAccountConnected?(t=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbPeopleL2LatencyTimeout)!==null&&t!==void 0?t:n.MsbPeopleLatencyTimeout:(i=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.latencyTimeout)!==null&&i!==void 0?i:n.LatencyTimeout:n.LatencyTimeout}queueSuggestions(t,i,r,u,f){if(t>this._sequenceNumber){SharedLogHelper.LogError("queueSuggestions",null,new Error("Unexpected sequence number"));return}if(!(t<this._sequenceNumber)){if(this._dataSourcesCompleted[i]){SharedLogHelper.LogError("queueSuggestions",i,new Error(`Data source already completed: ${i}`));return}if(!n.contains(this._highPriorityDataSources,i)&&!n.contains(this._normalPriorityDataSources,i)&&!n.contains(this._lowPriorityDataSources,i)){SharedLogHelper.LogError("queueSuggestions",i,new Error("Unexpected data source"));return}this._allDataSourcesArrived||(this._suggestionsQueue[i]&&!this._suggestionsQueue[i].updated?this._suggestionsQueue[i].suggestions.push(...r):this._suggestionsQueue[i]={suggestions:r,updated:!1},this._dataSourcesCompleted[i]=!f,u&&(this._extraSignalsMap[i]=u),f||this._arrivedDataSources.push(i),this._allDataSourcesArrived=this.haveAllDataSourcesArrived(this._highPriorityDataSources.concat(this._normalPriorityDataSources).concat(this._lowPriorityDataSources)),this._processingStopped||n.InstrumentationHelper.isLayoutLogged(this._sequenceNumber)?this._allDataSourcesArrived&&(this.resetTimers(),n.InstrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber)):this.processSuggestions(!1))}}resetTimers(){this._bufferingTimer&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null);this._processingTimeoutTimer&&(sb_ct(this._processingTimeoutTimer),this._processingTimeoutTimer=null)}resetStateForNewQuery(t,i){this._arrivedDataSources=[];this._allProcessedDataSources={};this._sequenceNumber=t;this._partialQuery=i;this._suggestionsQueue={};this._dataSourcesCompleted={};this._extraSignalsMap={};this._renderedThisSequenceNumber=!1;this._waitingForMoreResults=!0;this._processingStopped=!1;this._allDataSourcesArrived=n.isEmpty(i.enabledDataSources);this.resetTimers()}getDependencies(t){return n.Host.dataSourceDependencies(t).filter(t=>n.isDataSourceEnabled(t,this._partialQuery))}haveAllDataSourcesArrived(t){return n.config.mergeQueries&&this._partialQuery.scope==n.Scope.Documents?t.every(n=>{switch(n){case"MPHO":case"MVID":case"MDOC":return!!this._partialQuery.enabledDataSources.MPHO&&!!this._partialQuery.enabledDataSources.MVID&&!!this._partialQuery.enabledDataSources.MDOC&&!!this._partialQuery.enabledDataSources.MPVD;default:return!!this._suggestionsQueue[n]}}):t.every(i=>{var r,u;if(i=="MSBC"){const t=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.isWaitForBackfillEnabled(this._partialQuery.scope),f=!!this._suggestionsQueue[i]&&(((u=(r=this._suggestionsQueue[i])===null||r===void 0?void 0:r.suggestions)===null||u===void 0?void 0:u.length)>0||this._dataSourcesCompleted[i]);return t?f:!!this._suggestionsQueue[i]}return!!this._suggestionsQueue[i]&&this.haveCacheBackedDataSourcesArrived(t)})}haveCacheBackedDataSourcesArrived(t){if(this._partialQuery.isSearchHomeZI&&n.isMsbQwsDocsCacheEnabled(this._partialQuery)&&!n.config.msbQwsDocsNoRefreshAfterCachedResults){const i="SSUE",r="SREE",s=!!this._partialQuery.enabledDataSources[i]&&n.isDocSourceEnabledInQws(i),h=!!this._partialQuery.enabledDataSources[r]&&n.isDocSourceEnabledInQws(r);let u=!1,f=!1;t.forEach(n=>{n==i?u=!0:(n=r)&&(f=!0)});const e=u&&s,o=f&&h;if(e||o){const n=e&&this._dataSourcesCompleted[i],t=o&&this._dataSourcesCompleted[r];return n||t}return!0}return!0}haveAllDataSourcesCompleted(t){return n.config.mergeQueries&&this._partialQuery.scope==n.Scope.Documents?t.every(n=>{switch(n){case"MPHO":case"MVID":case"MDOC":return!!this._partialQuery.enabledDataSources.MPHO&&!!this._partialQuery.enabledDataSources.MVID&&!!this._partialQuery.enabledDataSources.MDOC&&!!this._partialQuery.enabledDataSources.MPVD;default:return!!this._dataSourcesCompleted[n]}}):t.every(n=>!!this._dataSourcesCompleted[n])}processSuggestions(t){let r=[],e=[],i,l=this.getLatencyTimeout()>0&&this._bufferingTimer==null,o=this.haveAllDataSourcesArrived(this._highPriorityDataSources),s=o||l,a=this.haveAllDataSourcesCompleted(this._normalPriorityDataSources),h=this.haveAllDataSourcesCompleted(this._highPriorityDataSources),c=h&&a;t&&n.InstrumentationHelper.logDataSourceTimeout(Object.keys(this._suggestionsQueue),this._partialQuery);let u=t&&!this._renderedThisSequenceNumber,v=(t,f)=>{if(!t.updated&&this.getDependencies(f).every(t=>n.contains(this._arrivedDataSources,t))){if(e.push(f),this._allProcessedDataSources[f]=!0,t.suggestions.length>0){let e=this.canHaveSuppressions(f)?t.suggestions.filter(n=>!this.isSuppressed(f,n)):t.suggestions;if(e.length>0){i&&i.length!==0||(i=this._renderedThisSequenceNumber?this._rootViewModel.getSuggestions(!0):[]);let[t,o]=this.removeDuplicatesAndAssignIds(e,i,r,f);if(n.config.enableMruProviderInQF&&f=="Web"){if(f=="Web"){let n=[];t.forEach(t=>{r.find(n=>(n===null||n===void 0?void 0:n.query)==(t===null||t===void 0?void 0:t.query))||i.find(n=>(n===null||n===void 0?void 0:n.query)==(t===null||t===void 0?void 0:t.query))||n.push(t)});r=r.concat(n)}}else r=r.concat(t);o&&(u=!0)}}t.updated=!0}};const f=n=>{for(let t in n){let i=n[t],r=this._suggestionsQueue[i];r&&v(r,i)}};s&&f(this._highPriorityDataSources);this._bufferingTimer&&c&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null);let y=s&&!this._HighPriDoneProcessing,p=y||(this.getLatencyTimeout()>0?this._bufferingTimer==null:o);p&&(f(this._normalPriorityDataSources),f(this._lowPriorityDataSources));this._waitingForMoreResults&&c&&(this._waitingForMoreResults=!1,(!this._renderedThisSequenceNumber||this._rootViewModel.mayNeedFlush()||(i||this._rootViewModel.getSuggestions(!0)).length==0)&&(u=!0));this._partialQuery.showProgressBar&&this._allDataSourcesArrived&&(u=!0);(r.length>0||u)&&(i||(i=this._renderedThisSequenceNumber?this._rootViewModel.getSuggestions(!0):[]),this.addSuggestions(i,r,e,u));this._allDataSourcesArrived&&(this.resetTimers(),n.InstrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber),this._rootViewModel.toggleProgressBar(!1));this._HighPriDoneProcessing=h}getAggregatorResult(n,t,i){let r=this.waitingForWebProvider();return this._aggregator.rank(t,i,this._extraSignalsMap,this._partialQuery,n,this._sequenceNumber,r)}waitingForWebProvider(){return n.isBrowserOnline()&&["Web"].concat(this.getDependencies("Web")).some(t=>n.isDataSourceEnabled(t,this._partialQuery)&&!this._allProcessedDataSources[t])}addSuggestions(t,i,r,u){let e=this._renderedThisSequenceNumber?this._rootViewModel.getCurrentTopResults():[],f=n.safeExecute(()=>this.getAggregatorResult(e,t,i),"getAggregatorResults",null);f||(f={topResults:e,suggestionsToAdd:i,suggestionsToRemove:[],groupOrder:[]});n.InstrumentationHelper.instrumentAggregatorCall(this._sequenceNumber);n.shouldShowDSBLayout(this._partialQuery)&&n.InstrumentationHelper.instrumentDSB();i=f.suggestionsToAdd;let o=f.suggestionsToRemove;for(let i of f.topResults)n.contains(t,i)&&!n.contains(e,i)&&o.push(i);if(u||i.length!=0||o.length!=0||!n.sequenceEqual(e,f.topResults)){let s=!this._renderedThisSequenceNumber;if(s&&(this._renderedThisSequenceNumber=!0,n.InstrumentationHelper.instrumentRenderingStarted(this._sequenceNumber)),n.config.useGroupTitleEdgeBS&&this._partialQuery&&!this._partialQuery.isSearchHomeZI&&i)for(let t of i)t&&(t.type=="ANAF"||t.type=="ANAH"||t.type=="ANAR"||t.type=="ANAT")&&(t.staticGroupType=n.GroupType.AnaheimDataQF);let h=n.safeExecute(()=>this._rootViewModel.update(s,f.topResults,this._waitingForMoreResults,this._sequenceNumber,i,o,r,f.groupOrder,this._allDataSourcesArrived,this._extraSignalsMap),"rootViewModel.update",0,null,t=>{n&&n.fallbackToPrepopulatedBundle&&n.fallbackToPrepopulatedBundle(t)});h==0&&(this._processingStopped=!0,this.resetTimers())}}isAnaheimSuggestionDupeWithMRU(t,i){if(i.type=="ANAH"||i.type=="ANAR"){let r=i;if(n.isBingSearchUrl(r.url)){let i=n.extractQueryFromBingSearchUrl(r.url);if(i&&n.contains(t,i))return!0}}return!1}removeDuplicatesAndAssignIds(t,i,r,u){var f;let o=n=>{var t,i;n.id||(n.id=n.path?n.path:n.type+n.text+((t=n.additionalInfoText)!==null&&t!==void 0?t:"")+(n.handoffType===17?(i=n.reactKey)!==null&&i!==void 0?i:"":""))},e=!1;if(u=="ANA"&&this._suggestionsQueue.MRS){let n=(f=this._suggestionsQueue.MRS.suggestions)===null||f===void 0?void 0:f.map(n=>n.query);n&&(t=t.filter(t=>!this.isAnaheimSuggestionDupeWithMRU(n,t)))}if(this._aggregator.canHaveDuplicates(u,this._partialQuery)){let f=[];for(let s=0;s<t.length;++s){const c=t[s];let h=i.findIndex(n=>this._aggregator.mergeDuplicates(this._partialQuer